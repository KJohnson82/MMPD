@using Microsoft.EntityFrameworkCore
@using Telerik.Blazor
@using Telerik.Blazor.Components
@using Telerik.SvgIcons
@using MMPD.Data.Data
@using MMPD.Data.Models
@using MMPD.Data.Context
@using MMPD.Shared.Components
@using MMPD.Shared.Layout

@inject AppDbContext dbContext

<TelerikChart>
    <ChartSeriesItems>
        <ChartSeries Type="ChartSeriesType.Bar" Data="@employeeCounts" Field="EmployeeCount" CategoryField="DepartmentName">
        </ChartSeries>
    </ChartSeriesItems>
    <ChartTitle Text="Employees by Department"></ChartTitle>
    <ChartLegend Position="ChartLegendPosition.Bottom"></ChartLegend>
</TelerikChart>



@code {

    public List<EmployeeCountModel> employeeCounts { get; set; } = new();

    public class EmployeeCountModel
    {
        public string DepartmentName { get; set; }
        public int EmployeeCount { get; set; }
    }

    protected override async Task OnInitializedAsync()
    {
        employeeCounts = await dbContext.Employees
            .GroupBy(e => e.Department)
            .Select(g => new EmployeeCountModel
                {
                    DepartmentName = dbContext.Departments.FirstOrDefault(d => d.Id == g.Key).DeptName,
                    EmployeeCount = g.Count()
                })
            .ToListAsync();
    }

}
