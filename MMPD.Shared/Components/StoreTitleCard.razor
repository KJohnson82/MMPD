@using Telerik.Blazor.Components
@using Telerik.Blazor

@inject NavigationManager NavManager

@if (StoreInfo is not null)
{
    <div class="store-card-wrapper">
        <TelerikGridLayout RowSpacing="1" ColumnSpacing="0" Class="store-grid-layout">
            <GridLayoutColumns>
                <GridLayoutColumn Width="1fr" />
            </GridLayoutColumns>
            <GridLayoutRows>
                <GridLayoutRow Height="@GetTitleHeight()" />
                <GridLayoutRow Height="2px" />
                <GridLayoutRow Height="@GetContentHeight()" />
                <GridLayoutRow Height="50px" />
            </GridLayoutRows>
            <GridLayoutItems>
                <!-- Title Section -->
                <GridLayoutItem Row="1" Column="1" Class="store-title-item">
                    <div class="store-title">
                        <span class="title-text" style="font-size: @GetOptimalFontSize()">
                            @StoreInfo.Title
                        </span>
                    </div>
                </GridLayoutItem>

                <!-- Divider -->
                <GridLayoutItem Row="2" Column="1">
                    @* <div class="divider"></div> *@
                </GridLayoutItem>

                <!-- Manager Info Section -->
                <GridLayoutItem Row="3" Column="1" Class="store-content-item">
                    <div class="info-section">
                        @if (!string.IsNullOrWhiteSpace(StoreInfo.StoreManager))
                        {
                            <div class="contact-section-1">
                                <div class="section-subtitle">STORE MANAGER</div>
                                <div class="section-border"></div>
                                <div class="section-text">@StoreInfo.StoreManager.ToUpper()</div>
                            </div>
                        }

                        @if (!string.IsNullOrWhiteSpace(StoreInfo.AreaManager))
                        {
                            <div class="contact-section-2">
                                <div class="section-subtitle">AREA MANAGER</div>
                                <div class="section-border"></div>
                                <div class="section-text">@StoreInfo.AreaManager.ToUpper()</div>
                            </div>
                        }
                    </div>
                </GridLayoutItem>

                <GridLayoutItem Row="4" Column="1" RowSpan="2" Class="search-section-item">
                    @* <SearchBar ShowBackButton="!IsHomePage" /> *@
                    <SearchBar />
                </GridLayoutItem>
            </GridLayoutItems>
        </TelerikGridLayout>
    </div>
}

@code {
    [Parameter]
    public StoreTitleCardModel? StoreInfo { get; set; }

    private bool IsHomePage
    {
        get
        {
            var relativePath = NavManager.ToBaseRelativePath(NavManager.Uri);
            return relativePath == "" || relativePath.Equals("home", StringComparison.OrdinalIgnoreCase);
        }
    }

    private string GetTitleHeight()
    {
        // Adjust title area height based on title length
        if (StoreInfo?.Title?.Length > 20)
            return "55px";
        return "50px";
    }

    private string GetContentHeight()
    {
        // Calculate remaining height for content
        // Total: 250px - Title (50-55px) - Divider (2px) - Search (45px) = ~148-153px
        if (StoreInfo?.Title?.Length > 20)
            return "148px";
        return "153px";
    }

    private string GetOptimalFontSize()
    {
        if (StoreInfo?.Title == null) return "28px";

        int titleLength = StoreInfo.Title.Length;

        // Optimized for ~400px window width
        return titleLength switch
        {
            > 30 => "19px",
            > 25 => "20px",
            > 20 => "23px",
            > 15 => "26px",
            > 10 => "30px",
            _ => "34px"
        };
    }

    public class StoreTitleCardModel
    {
        public string Title { get; set; } = string.Empty;
        public string StoreManager { get; set; } = string.Empty;
        public string AreaManager { get; set; } = string.Empty;
    }
}

<style>
    /* CSS Variables */
    :root {
        --store-card-bg: #FF6666;
        --store-card-text: white;
        --divider-color: rgba(255, 255, 255, 0.3);
    }

    /* Main Container */
    .store-card-wrapper {
        width: 100%;
        background-color: var(--kendo-color-primary);
        color: var(--store-card-text);
        position: relative;
        overflow: hidden;
    }

    .store-grid-layout {
        height: 100%;
        background-color: var(--kendo-color-primary);
    }

    /* Title Section */
    .store-title-item {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--kendo-color-primary);
        height: 100%;
    }

    .store-title {
        width: 100%;
        text-align: center;
    }

    .title-text {
        font-weight: bold;
        text-transform: uppercase;
        color: var(--store-card-text);
        line-height: 1.1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
        padding: 0 8px;
        display: inline-block;
        letter-spacing: 0.02em;
    }

    /* Divider */
    .divider {
        width: 100%;
        height: 2px;
        border-bottom: solid 2px var(--kendo-color-primary-subtle);
        opacity: 0.25;
    }

    /* Content Layout - Matches HeadTitleCard Dimensions */
    .store-content-item {
        padding: 4px 0; /* Same as header-content-item */
        overflow: hidden;
        height: 100%;
        display: flex;
        align-items: flex-start; /* Same as header-content-item */
    }

    .info-section {
        padding-top: 0.5rem; /* pt-2 */
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 4px; /* Same gap as content-container */
    }

    /* Store Manager Section - Right Side */
    .contact-section-1 {
        margin-inline-end: 7rem; /* me-28 */
        margin-top: 0; /* mt-0 */
        white-space: nowrap; /* text-nowrap */
        text-align: right; /* text-right */
    }

    /* Area Manager Section - Left Side */
    .contact-section-2 {
        margin-inline-start: 7rem; /* ms-28 */
        margin-top: 0.75rem; /* mt-3 */
        white-space: nowrap; /* text-nowrap */
        text-align: left; /* text-left */
    }

    /* Section Subtitle Styling */
    .section-subtitle {
        text-transform: uppercase; /* uppercase */
        letter-spacing: 0.1em; /* tracking-wide */
        font-weight: 500; /* font-medium */
        padding-inline-start: 1px; /* ps-[1px] */
        margin-bottom: -0.5rem; /* -mb-2 */
        padding-bottom: 0.375rem; /* pb-1.5 */
        color: var(--store-card-text);
    }

    /* Section Border */
    .section-border {
        border-bottom: 2px solid rgba(226, 232, 240, 0.45); /* border-b-2 border-slate-200 border-opacity-45 */
        margin: 0; /* m-0 */
        border-left: 0; /* border-x-0 */
        border-right: 0; /* border-x-0 */
    }

    /* Section Text */
    .section-text {
        margin-top: -6px; /* -mt-[6px] */
        text-transform: uppercase; /* uppercase */
        letter-spacing: normal; /* tracking-normal */
        font-weight: normal; /* font-normal */
        padding-top: 0.375rem; /* pt-1.5 */
        padding-inline-start: 1px; /* ps-[1px] */
        color: var(--store-card-text);
    }

    /* Search Section */
    .search-section-item {
        background-color: rgba(0, 0, 0, 0.08);
        border-top: 1px solid var(--divider-color);
        height: 100%;
        align-items: center;
        @* display: flex; *@
        align-items: center;
    }

   @*  /* Responsive adjustments */
    @media (max-width: 480px) {
        .contact-section-1

    {
        margin-inline-end: 2rem; /* Reduce from me-28 to smaller margin */
    }

    .contact-section-2 {
        margin-inline-start: 2rem; /* Reduce from ms-28 to smaller margin */
    }

    .section-subtitle {
        font-size: 12px;
    }

    .section-text {
        font-size: 14px;
    }

    } *@
</style>