@page "/plant/{locationID:int}/{departmentID:int}/{employeeID:int}"
@using MMPD.Data.Models
@using MMPD.Data.Data
@using MMPD.Data.Context
@inject IDirectoryService DirectoryService
@using MMPD.Shared.Components
@using Telerik.Blazor.Components
@inject NavigationManager NavigationManager
@inject IJSRuntime JS
@using MMPD.Shared.Layout

<PageTitle>Plant Employee</PageTitle>

@if (Employee == null)
{
    <p>Loading employee...</p>
}
else
{
    <div class="flex flex-col h-screen">
        <section>
            <HeaderCard Info="EmployeeInfoCard" />
        </section>

        <div class="divide divide-none divide-y-2 py-0"></div>

        <section class="flex-grow bg-background justify-center overflow-y-scroll no-scrollbar">
            <section class="shadow-sm drop-shadow-sm">
                <BackButton />
            </section>

            <TelerikCard Class="mx-4 my-4 bg-primary text-white">
                <CardHeader>
                    <h2 class="text-2xl font-semibold">@Employee.FirstName @Employee.LastName</h2>
                    <p class="text-sm text-accent">@Employee.JobTitle</p>
                </CardHeader>
                <CardBody Class="bg-secondary">
                    <div class="text-sm space-y-1">
                        @if (!string.IsNullOrWhiteSpace(Employee.Email))
                        {
                            <div><strong>Email:</strong> @Employee.Email</div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Employee.PhoneNumber))
                        {
                            <div><strong>Phone:</strong> @Employee.PhoneNumber</div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Employee.Extension))
                        {
                            <div><strong>Extension:</strong> @Employee.Extension</div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Employee.CellNumber))
                        {
                            <div><strong>Cell:</strong> @Employee.CellNumber</div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Employee.NetworkId))
                        {
                            <div><strong>Network ID:</strong> @Employee.NetworkId</div>
                        }
                    </div>
                </CardBody>
                @* <CardActions Class="bg-primary">
                    <TelerikButton OnClick="@GoBack" Icon="SvgIcon.ArrowLeft">Back</TelerikButton>
                </CardActions> *@
            </TelerikCard>
        </section>

        <div class="divide divide-none divide-y-2 py-0"></div>
        <section class="box-border pb-3 mt-0">
            <FooterNav Items="FooterNav" />
        </section>
    </div>
}

@code {
    [Parameter] public int locationID { get; set; }
    [Parameter] public int departmentID { get; set; }
    [Parameter] public int employeeID { get; set; }

    private Department? Department;
    private Employee? Employee;
    private HeaderCard.HeadInfoCardModel EmployeeInfoCard = new();

    private List<FooterNav.FooterItem> FooterNav = new()
    {
        new(CustomIcons.Home, "Home", "/"),
        new(CustomIcons.Corporate, "Corporate", "/corporate"),
        new(CustomIcons.MetalMart, "Metal Mart", "/metalmart"),
        new(CustomIcons.ServiceCenter, "Service Center", "/servicecenter")
    };

    protected override async Task OnParametersSetAsync()
    {

        Employee = await DirectoryService.GetEmployeeByIdAsync(employeeID);
        // var data = await DirectoryService.GetDataRootAsync();
        // Department = data?.Loctype["plant"].Locations
        //     .FirstOrDefault(l => l.Id == locationID)?.Departments
        //     .FirstOrDefault(d => d.Id == departmentID);

        // Employee = Department?.Employees
        //     .FirstOrDefault(e => e.Id == employeeID);

        if (Employee is not null)
        {
            EmployeeInfoCard = new HeaderCard.HeadInfoCardModel
            {
                Title = Department?.DeptName ?? ""
            };
        }
    }

    private async void GoBack()
    {
        await JS.InvokeVoidAsync("goBack");
    }
}
